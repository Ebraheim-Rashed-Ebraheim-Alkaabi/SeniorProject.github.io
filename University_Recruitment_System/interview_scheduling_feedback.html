<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interview Scheduling & Feedback</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#06b6d4; --success:#10b981; --danger:#ef4444; --radius:12px; color-scheme:dark;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color:#e6eef6;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071026);}
    .wrap{max-width:1200px;margin:28px auto;padding:20px;display:grid;grid-template-columns:1fr 420px;gap:18px}
    h1{font-size:20px;margin:0}
    .sub{color:var(--muted);font-size:13px}
    .card{background:linear-gradient(180deg,var(--card),rgba(255,255,255,0.02));padding:16px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    input,select,textarea,button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit}
    button{cursor:pointer}
    .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:12px}
    .day{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);min-height:90px}
    .day .date{font-weight:700}
    .slot{display:block;margin-top:8px;padding:6px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:13px}
    .slot .time{font-weight:600}
    .proposals{margin-top:12px}
    .proposal-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);margin-top:8px}
    .panel-feedback{display:flex;flex-direction:column;gap:10px}
    .feedback-row{display:flex;gap:8px;align-items:center}
    .rating input{width:44px}
    .rec-box{display:flex;gap:8px;align-items:center}
    .rec-box button{border:none;padding:8px 12px;border-radius:8px}
    .rec-yes{background:var(--success);color:#022}
    .rec-no{background:var(--danger);color:white}
    .rec-maybe{background:rgba(255,255,255,0.03);color:var(--muted)}
    .aggregated{margin-top:12px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .small{font-size:13px;color:var(--muted)}
    @media(max-width:1000px){.wrap{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <main>
      <header>
        <div>
          <h1>Interview Scheduling & Feedback</h1>
          <div class="sub">Mock calendar to propose dates. Feedback form and auto-aggregation of panel recommendations.</div>
        </div>
        <div style="display:flex;gap:8px">
          <input id="candidate" placeholder="Candidate name" />
          <select id="duration"><option>30 min</option><option>45 min</option><option>60 min</option></select>
        </div>
      </header>

      <section class="card">
        <strong>Week view (mock)</strong>
        <div class="small">Click a slot to propose it. Proposed slots show in the proposals list.</div>
        <div class="calendar" id="calendar"></div>

        <div class="proposals card" style="margin-top:12px">
          <strong>Proposed interview times</strong>
          <div id="proposals-list"></div>
          <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
            <button id="send-invites">Mock Send Invites</button>
            <div class="small">(this is a mock. No external calendar is contacted.)</div>
          </div>
        </div>
      </section>

      <section class="card" style="margin-top:12px">
        <strong>Panel members</strong>
        <div class="small">Add panel members who will submit feedback</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="panel-name" placeholder="Name e.g. Dr. Lee" />
          <button id="add-panel">Add</button>
        </div>
        <div id="panel-list" style="margin-top:10px"></div>
      </section>
    </main>

    <aside>
      <div class="card">
        <strong>Post-interview feedback</strong>
        <div class="small">Select panel member to enter their feedback. Feedback auto-captures a recommendation.</div>
        <div style="margin-top:10px">
          <select id="select-panel"><option value="">Select panel member</option></select>
        </div>

        <form id="feedback-form" class="panel-feedback" style="margin-top:12px">
          <label class="small">Technical performance</label>
          <textarea id="f-tech" placeholder="Notes on technical competence"></textarea>

          <label class="small">Behavioral traits</label>
          <textarea id="f-behavior" placeholder="Notes on behavioral traits"></textarea>

          <label class="small">Values alignment</label>
          <textarea id="f-values" placeholder="Notes on values alignment"></textarea>

          <div class="feedback-row">
            <label class="small">Interview rating (1-5)</label>
            <div class="rating"><input id="f-rating" type="number" min="1" max="5" placeholder="3" /></div>
          </div>

          <div class="feedback-row">
            <label class="small">Recommendation</label>
            <div class="rec-box">
              <button type="button" class="rec-yes" data-rec="recommend">Recommend</button>
              <button type="button" class="rec-maybe" data-rec="maybe">Maybe</button>
              <button type="button" class="rec-no" data-rec="reject">Reject</button>
            </div>
          </div>

          <label class="small">Justification</label>
          <textarea id="f-just" placeholder="Short justification (required for reject)"></textarea>

          <div style="display:flex;gap:8px;justify-content:flex-end">
            <button id="save-feedback" type="button">Save feedback</button>
          </div>
        </form>

        <div class="aggregated" id="aggregated">
          <strong>Aggregated panel recommendations</strong>
          <div id="agg-content" style="margin-top:8px" class="small">No feedback yet.</div>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // Utilities
    function formatDate(d){return d.toISOString().slice(0,10);} // YYYY-MM-DD
    function formatTime(d){return d.toTimeString().slice(0,5);} // HH:MM

    // Build a mock week starting today
    const calendarEl=document.getElementById('calendar');
    const proposals=[];
    const today=new Date();
    const start=new Date(today);
    start.setDate(today.getDate() - today.getDay() + 1); // monday

    for(let i=0;i<7;i++){
      const day=new Date(start);
      day.setDate(start.getDate()+i);
      const dayEl=document.createElement('div'); dayEl.className='day';
      dayEl.innerHTML=`<div class="date">${day.toDateString().split(' ').slice(0,3).join(' ')}</div>`;
      // sample slots
      const slots=['09:00','10:30','13:00','15:00'];
      slots.forEach(t=>{
        const slotEl=document.createElement('button');
        slotEl.className='slot';
        slotEl.type='button';
        slotEl.innerHTML=`<div class="time">${t}</div>`;
        slotEl.addEventListener('click',()=>{
          const candidate=document.getElementById('candidate').value.trim()||'Candidate';
          const duration=document.getElementById('duration').value;
          const id=proposals.length+1;
          const item={id, date:formatDate(day), time:t, duration, candidate};
          proposals.push(item);
          renderProposals();
        });
        dayEl.appendChild(slotEl);
      });
      calendarEl.appendChild(dayEl);
    }

    function renderProposals(){
      const list=document.getElementById('proposals-list'); list.innerHTML='';
      if(proposals.length===0){list.innerHTML='<div class="small">No proposed times.</div>';return}
      proposals.forEach(p=>{
        const div=document.createElement('div'); div.className='proposal-item';
        div.innerHTML=`<div><strong>${p.candidate}</strong> · ${p.date} ${p.time} · ${p.duration}</div><div><button data-id="${p.id}" class="remove">Remove</button></div>`;
        list.appendChild(div);
      });
      document.querySelectorAll('.remove').forEach(b=>b.addEventListener('click',e=>{
        const id=Number(e.target.dataset.id); const idx=proposals.findIndex(x=>x.id===id); if(idx>-1)proposals.splice(idx,1);renderProposals();
      }));
    }

    document.getElementById('send-invites').addEventListener('click',()=>{
      if(proposals.length===0){alert('No proposed times to send.');return}
      alert('Mock invites sent for '+proposals.length+' proposed times.');
    });

    // Panel members
    const panel=[];
    function renderPanelList(){
      const pl=document.getElementById('panel-list'); pl.innerHTML='';
      const sel=document.getElementById('select-panel'); sel.innerHTML='<option value="">Select panel member</option>';
      panel.forEach((p,idx)=>{
        const div=document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.marginTop='8px';
        div.innerHTML=`<div>${p.name}</div><div><button data-idx="${idx}" class="rem">Remove</button></div>`;
        pl.appendChild(div);
        const opt=document.createElement('option'); opt.value=idx; opt.textContent=p.name; sel.appendChild(opt);
      });
      document.querySelectorAll('.rem').forEach(b=>b.addEventListener('click',e=>{panel.splice(Number(e.target.dataset.idx),1);renderPanelList();updateAgg();}));
    }

    document.getElementById('add-panel').addEventListener('click',()=>{
      const name=document.getElementById('panel-name').value.trim(); if(!name) return; panel.push({name, feedback:[]}); document.getElementById('panel-name').value=''; renderPanelList();
    });

    // Feedback capture per panel member
    let currentRec='';
    document.querySelectorAll('.rec-box button').forEach(b=>{
      b.addEventListener('click',()=>{
        currentRec=b.dataset.rec;
        // visual toggle
        document.querySelectorAll('.rec-box button').forEach(x=>x.style.outline=''); b.style.outline='2px solid rgba(255,255,255,0.06)';
      });
    });

    document.getElementById('save-feedback').addEventListener('click',()=>{
      const sel=document.getElementById('select-panel'); const selIdx=sel.value; if(selIdx===''){alert('Select panel member');return}
      const member=panel[selIdx]; if(!member){alert('Panel member not found');return}
      const feedback={tech:document.getElementById('f-tech').value.trim(), behavior:document.getElementById('f-behavior').value.trim(), values:document.getElementById('f-values').value.trim(), rating:document.getElementById('f-rating').value, rec:currentRec||'maybe', just:document.getElementById('f-just').value.trim(), time:new Date().toISOString()};
      // require justification for rejects
      if(feedback.rec==='reject' && !feedback.just){alert('Justification required for reject');return}
      member.feedback.push(feedback);
      // clear form
      document.getElementById('f-tech').value=''; document.getElementById('f-behavior').value=''; document.getElementById('f-values').value=''; document.getElementById('f-rating').value=''; document.getElementById('f-just').value=''; currentRec=''; document.querySelectorAll('.rec-box button').forEach(x=>x.style.outline='');
      updateAgg();
      alert('Feedback saved for '+member.name);
    });

    function updateAgg(){
      // aggregate across panel members for latest candidate (assumes one candidate context in mock)
      const all=[]; panel.forEach(p=>p.feedback.forEach(f=>all.push({...f,by:p.name}))); 
      const agg=document.getElementById('agg-content'); if(all.length===0){agg.textContent='No feedback yet.'; return}
      const counts={recommend:0,maybe:0,reject:0}; let avgRating=0; all.forEach(f=>{counts[f.rec]=(counts[f.rec]||0)+1; avgRating+=Number(f.rating)||0}); avgRating = (avgRating/all.length).toFixed(2);
      // latest comments
      const last=all.slice(-5).reverse().map(f=>`• ${f.by}: ${f.rec.toUpperCase()} (rating ${f.rating||'N/A'}) — ${f.just||'(no justification)'} `).join('\n');
      agg.innerHTML=`<div>Recommend: ${counts.recommend} · Maybe: ${counts.maybe} · Reject: ${counts.reject}</div><div style="margin-top:6px">Average rating: ${avgRating}</div><pre style="white-space:pre-wrap;margin-top:8px;font-size:13px;color:var(--muted)">${last}</pre>`;
    }

    // ensure select-panel updates when panel list changes
    const observer = new MutationObserver(()=>{ /* placeholder in case we need to react */ });
    observer.observe(document.getElementById('panel-list'),{childList:true, subtree:true});

    // initial render
    renderProposals(); renderPanelList(); updateAgg();
  </script>
  
  <!-- Authentication Check -->
  <script src="auth_check.js"></script>
</body>
</html>
